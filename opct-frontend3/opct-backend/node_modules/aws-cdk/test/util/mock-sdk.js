"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockSdk = exports.MockSdkProvider = exports.setDefaultSTSMocks = exports.restoreSdkMocksToDefault = exports.mockSTSClient = exports.mockStepFunctionsClient = exports.mockSSMClient = exports.mockSecretsManagerClient = exports.mockS3Client = exports.mockRoute53Client = exports.mockLambdaClient = exports.mockKMSClient = exports.mockIAMClient = exports.mockElasticLoadBalancingV2Client = exports.mockECSClient = exports.mockECRClient = exports.mockEC2Client = exports.mockCodeBuildClient = exports.mockCloudWatchClient = exports.mockCloudFormationClient = exports.mockAppSyncClient = exports.FAKE_CREDENTIALS = void 0;
exports.mockBootstrapStack = mockBootstrapStack;
exports.mockResolvedEnvironment = mockResolvedEnvironment;
require("aws-sdk-client-mock-jest");
const client_appsync_1 = require("@aws-sdk/client-appsync");
const client_cloudformation_1 = require("@aws-sdk/client-cloudformation");
const client_cloudwatch_logs_1 = require("@aws-sdk/client-cloudwatch-logs");
const client_codebuild_1 = require("@aws-sdk/client-codebuild");
const client_ec2_1 = require("@aws-sdk/client-ec2");
const client_ecr_1 = require("@aws-sdk/client-ecr");
const client_ecs_1 = require("@aws-sdk/client-ecs");
const client_elastic_load_balancing_v2_1 = require("@aws-sdk/client-elastic-load-balancing-v2");
const client_iam_1 = require("@aws-sdk/client-iam");
const client_kms_1 = require("@aws-sdk/client-kms");
const client_lambda_1 = require("@aws-sdk/client-lambda");
const client_route_53_1 = require("@aws-sdk/client-route-53");
const client_s3_1 = require("@aws-sdk/client-s3");
const client_secrets_manager_1 = require("@aws-sdk/client-secrets-manager");
const client_sfn_1 = require("@aws-sdk/client-sfn");
const client_ssm_1 = require("@aws-sdk/client-ssm");
const client_sts_1 = require("@aws-sdk/client-sts");
const credential_providers_1 = require("@aws-sdk/credential-providers");
const aws_sdk_client_mock_1 = require("aws-sdk-client-mock");
const lib_1 = require("../../lib");
const cloudformation_1 = require("../../lib/api/util/cloudformation");
exports.FAKE_CREDENTIALS = {
    accessKeyId: 'ACCESS',
    secretAccessKey: 'SECRET',
    sessionToken: 'TOKEN ',
};
const FAKE_CREDENTIAL_CHAIN = (0, credential_providers_1.createCredentialChain)(() => Promise.resolve(exports.FAKE_CREDENTIALS));
// Default implementations
exports.mockAppSyncClient = (0, aws_sdk_client_mock_1.mockClient)(client_appsync_1.AppSyncClient);
exports.mockCloudFormationClient = (0, aws_sdk_client_mock_1.mockClient)(client_cloudformation_1.CloudFormationClient);
exports.mockCloudWatchClient = (0, aws_sdk_client_mock_1.mockClient)(client_cloudwatch_logs_1.CloudWatchLogsClient);
exports.mockCodeBuildClient = (0, aws_sdk_client_mock_1.mockClient)(client_codebuild_1.CodeBuildClient);
exports.mockEC2Client = (0, aws_sdk_client_mock_1.mockClient)(client_ec2_1.EC2Client);
exports.mockECRClient = (0, aws_sdk_client_mock_1.mockClient)(client_ecr_1.ECRClient);
exports.mockECSClient = (0, aws_sdk_client_mock_1.mockClient)(client_ecs_1.ECSClient);
exports.mockElasticLoadBalancingV2Client = (0, aws_sdk_client_mock_1.mockClient)(client_elastic_load_balancing_v2_1.ElasticLoadBalancingV2Client);
exports.mockIAMClient = (0, aws_sdk_client_mock_1.mockClient)(client_iam_1.IAMClient);
exports.mockKMSClient = (0, aws_sdk_client_mock_1.mockClient)(client_kms_1.KMSClient);
exports.mockLambdaClient = (0, aws_sdk_client_mock_1.mockClient)(client_lambda_1.LambdaClient);
exports.mockRoute53Client = (0, aws_sdk_client_mock_1.mockClient)(client_route_53_1.Route53Client);
exports.mockS3Client = (0, aws_sdk_client_mock_1.mockClient)(client_s3_1.S3Client);
exports.mockSecretsManagerClient = (0, aws_sdk_client_mock_1.mockClient)(client_secrets_manager_1.SecretsManagerClient);
exports.mockSSMClient = (0, aws_sdk_client_mock_1.mockClient)(client_ssm_1.SSMClient);
exports.mockStepFunctionsClient = (0, aws_sdk_client_mock_1.mockClient)(client_sfn_1.SFNClient);
exports.mockSTSClient = (0, aws_sdk_client_mock_1.mockClient)(client_sts_1.STSClient);
/**
 * Resets clients back to defaults and resets the history
 * of usage of the mock.
 */
const restoreSdkMocksToDefault = () => {
    exports.mockAppSyncClient.reset();
    exports.mockAppSyncClient.onAnyCommand().resolves({});
    exports.mockCloudFormationClient.reset();
    exports.mockCloudFormationClient.onAnyCommand().resolves({});
    exports.mockCloudWatchClient.reset();
    exports.mockCloudWatchClient.onAnyCommand().resolves({});
    exports.mockCodeBuildClient.reset();
    exports.mockCodeBuildClient.onAnyCommand().resolves({});
    exports.mockEC2Client.reset();
    exports.mockEC2Client.onAnyCommand().resolves({});
    exports.mockECRClient.reset();
    exports.mockECRClient.onAnyCommand().resolves({});
    exports.mockECSClient.reset();
    exports.mockECSClient.onAnyCommand().resolves({});
    exports.mockElasticLoadBalancingV2Client.reset();
    exports.mockElasticLoadBalancingV2Client.onAnyCommand().resolves({});
    exports.mockIAMClient.reset();
    exports.mockIAMClient.onAnyCommand().resolves({});
    exports.mockKMSClient.reset();
    exports.mockKMSClient.onAnyCommand().resolves({});
    exports.mockLambdaClient.reset();
    exports.mockLambdaClient.onAnyCommand().resolves({});
    exports.mockRoute53Client.reset();
    exports.mockRoute53Client.onAnyCommand().resolves({});
    exports.mockS3Client.reset();
    exports.mockS3Client.onAnyCommand().resolves({});
    exports.mockSecretsManagerClient.reset();
    exports.mockSecretsManagerClient.onAnyCommand().resolves({});
    exports.mockSSMClient.reset();
    exports.mockSSMClient.onAnyCommand().resolves({});
    exports.mockStepFunctionsClient.reset();
    exports.mockSSMClient.onAnyCommand().resolves({});
    exports.mockSTSClient.reset();
};
exports.restoreSdkMocksToDefault = restoreSdkMocksToDefault;
const setDefaultSTSMocks = () => {
    exports.mockSTSClient.on(client_sts_1.GetCallerIdentityCommand).resolves({
        Account: '123456789012',
        Arn: 'aws:swa:123456789012:some-other-stuff',
    });
    exports.mockSTSClient.on(client_sts_1.AssumeRoleCommand).resolves({
        Credentials: {
            AccessKeyId: exports.FAKE_CREDENTIALS.accessKeyId,
            SecretAccessKey: exports.FAKE_CREDENTIALS.secretAccessKey,
            SessionToken: exports.FAKE_CREDENTIALS.sessionToken,
            Expiration: new Date(Date.now() + 3600 * 1000),
        },
    });
};
exports.setDefaultSTSMocks = setDefaultSTSMocks;
/**
 * MockSdkProvider that is mostly SdkProvider but
 * with fake credentials and account information.
 *
 * For mocking the actual clients, the above mocking
 * clients may be used.
 */
class MockSdkProvider extends lib_1.SdkProvider {
    constructor() {
        super(FAKE_CREDENTIAL_CHAIN, 'bermuda-triangle-1337');
    }
    defaultAccount() {
        return Promise.resolve({ accountId: '123456789012', partition: 'aws' });
    }
}
exports.MockSdkProvider = MockSdkProvider;
/**
 * MockSdk that is mostly just the SDK but with fake
 * credentials and a full set of default client mocks.
 * These individual functions within those clients can be
 * customized in the test file that uses it.
 */
class MockSdk extends lib_1.SDK {
    constructor() {
        (0, exports.restoreSdkMocksToDefault)();
        super(exports.FAKE_CREDENTIALS, 'bermuda-triangle-1337', {});
    }
}
exports.MockSdk = MockSdk;
function mockBootstrapStack(stack) {
    return cloudformation_1.CloudFormationStack.fromStaticInformation(new MockSdk().cloudFormation(), 'CDKToolkit', {
        CreationTime: new Date(),
        StackName: 'CDKToolkit',
        StackStatus: client_cloudformation_1.StackStatus.CREATE_COMPLETE,
        ...stack,
        Outputs: [
            { OutputKey: 'BucketName', OutputValue: 'BUCKET_NAME' },
            { OutputKey: 'BucketDomainName', OutputValue: 'BUCKET_ENDPOINT' },
            { OutputKey: 'ImageRepositoryName', OutputValue: 'REPO_NAME' },
            { OutputKey: 'BootstrapVersion', OutputValue: '1' },
            ...(stack?.Outputs ?? []),
        ],
    });
}
function mockResolvedEnvironment() {
    return {
        account: '123456789',
        region: 'bermuda-triangle-1337',
        name: 'aws://123456789/bermuda-triangle-1337',
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay1zZGsuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtb2NrLXNkay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUEwSUEsZ0RBY0M7QUFFRCwwREFNQztBQWhLRCxvQ0FBa0M7QUFFbEMsNERBQXdEO0FBQ3hELDBFQUEwRjtBQUMxRiw0RUFBdUU7QUFDdkUsZ0VBQTREO0FBQzVELG9EQUFnRDtBQUNoRCxvREFBZ0Q7QUFDaEQsb0RBQWdEO0FBQ2hELGdHQUF5RjtBQUN6RixvREFBZ0Q7QUFDaEQsb0RBQWdEO0FBQ2hELDBEQUFzRDtBQUN0RCw4REFBeUQ7QUFDekQsa0RBQThDO0FBQzlDLDRFQUF1RTtBQUN2RSxvREFBZ0Q7QUFDaEQsb0RBQWdEO0FBQ2hELG9EQUE2RjtBQUM3Rix3RUFBc0U7QUFFdEUsNkRBQWlEO0FBRWpELG1DQUE2QztBQUM3QyxzRUFBd0U7QUFFM0QsUUFBQSxnQkFBZ0IsR0FBMEI7SUFDckQsV0FBVyxFQUFFLFFBQVE7SUFDckIsZUFBZSxFQUFFLFFBQVE7SUFDekIsWUFBWSxFQUFFLFFBQVE7Q0FDdkIsQ0FBQztBQUVGLE1BQU0scUJBQXFCLEdBQUcsSUFBQSw0Q0FBcUIsRUFBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHdCQUFnQixDQUFDLENBQUMsQ0FBQztBQUU3RiwwQkFBMEI7QUFDYixRQUFBLGlCQUFpQixHQUFHLElBQUEsZ0NBQVUsRUFBQyw4QkFBYSxDQUFDLENBQUM7QUFDOUMsUUFBQSx3QkFBd0IsR0FBRyxJQUFBLGdDQUFVLEVBQUMsNENBQW9CLENBQUMsQ0FBQztBQUM1RCxRQUFBLG9CQUFvQixHQUFHLElBQUEsZ0NBQVUsRUFBQyw2Q0FBb0IsQ0FBQyxDQUFDO0FBQ3hELFFBQUEsbUJBQW1CLEdBQUcsSUFBQSxnQ0FBVSxFQUFDLGtDQUFlLENBQUMsQ0FBQztBQUNsRCxRQUFBLGFBQWEsR0FBRyxJQUFBLGdDQUFVLEVBQUMsc0JBQVMsQ0FBQyxDQUFDO0FBQ3RDLFFB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LEVBQUUsdUJBQXVCO1FBQy9CLElBQUksRUFBRSx1Q0FBdUM7S0FDOUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ2F3cy1zZGstY2xpZW50LW1vY2stamVzdCc7XG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJ0Bhd3MtY2RrL2N4LWFwaSc7XG5pbXBvcnQgeyBBcHBTeW5jQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWFwcHN5bmMnO1xuaW1wb3J0IHsgQ2xvdWRGb3JtYXRpb25DbGllbnQsIFN0YWNrLCBTdGFja1N0YXR1cyB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZGZvcm1hdGlvbic7XG5pbXBvcnQgeyBDbG91ZFdhdGNoTG9nc0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZHdhdGNoLWxvZ3MnO1xuaW1wb3J0IHsgQ29kZUJ1aWxkQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWNvZGVidWlsZCc7XG5pbXBvcnQgeyBFQzJDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtZWMyJztcbmltcG9ydCB7IEVDUkNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1lY3InO1xuaW1wb3J0IHsgRUNTQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWVjcyc7XG5pbXBvcnQgeyBFbGFzdGljTG9hZEJhbGFuY2luZ1YyQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWVsYXN0aWMtbG9hZC1iYWxhbmNpbmctdjInO1xuaW1wb3J0IHsgSUFNQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWlhbSc7XG5pbXBvcnQgeyBLTVNDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQta21zJztcbmltcG9ydCB7IExhbWJkYUNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1sYW1iZGEnO1xuaW1wb3J0IHsgUm91dGU1M0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1yb3V0ZS01Myc7XG5pbXBvcnQgeyBTM0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XG5pbXBvcnQgeyBTZWNyZXRzTWFuYWdlckNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zZWNyZXRzLW1hbmFnZXInO1xuaW1wb3J0IHsgU0ZOQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXNmbic7XG5pbXBvcnQgeyBTU01DbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc3NtJztcbmltcG9ydCB7IEFzc3VtZVJvbGVDb21tYW5kLCBHZXRDYWxsZXJJZGVudGl0eUNvbW1hbmQsIFNUU0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zdHMnO1xuaW1wb3J0IHsgY3JlYXRlQ3JlZGVudGlhbENoYWluIH0gZnJvbSAnQGF3cy1zZGsvY3JlZGVudGlhbC1wcm92aWRlcnMnO1xuaW1wb3J0IHsgQXdzQ3JlZGVudGlhbElkZW50aXR5IH0gZnJvbSAnQHNtaXRoeS90eXBlcyc7XG5pbXBvcnQgeyBtb2NrQ2xpZW50IH0gZnJvbSAnYXdzLXNkay1jbGllbnQtbW9jayc7XG5pbXBvcnQgeyBBY2NvdW50IH0gZnJvbSAnY2RrLWFzc2V0cyc7XG5pbXBvcnQgeyBTREssIFNka1Byb3ZpZGVyIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IENsb3VkRm9ybWF0aW9uU3RhY2sgfSBmcm9tICcuLi8uLi9saWIvYXBpL3V0aWwvY2xvdWRmb3JtYXRpb24nO1xuXG5leHBvcnQgY29uc3QgRkFLRV9DUkVERU5USUFMUzogQXdzQ3JlZGVudGlhbElkZW50aXR5ID0ge1xuICBhY2Nlc3NLZXlJZDogJ0FDQ0VTUycsXG4gIHNlY3JldEFjY2Vzc0tleTogJ1NFQ1JFVCcsXG4gIHNlc3Npb25Ub2tlbjogJ1RPS0VOICcsXG59O1xuXG5jb25zdCBGQUtFX0NSRURFTlRJQUxfQ0hBSU4gPSBjcmVhdGVDcmVkZW50aWFsQ2hhaW4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKEZBS0VfQ1JFREVOVElBTFMpKTtcblxuLy8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbnNcbmV4cG9ydCBjb25zdCBtb2NrQXBwU3luY0NsaWVudCA9IG1vY2tDbGllbnQoQXBwU3luY0NsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja0Nsb3VkRm9ybWF0aW9uQ2xpZW50ID0gbW9ja0NsaWVudChDbG91ZEZvcm1hdGlvbkNsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja0Nsb3VkV2F0Y2hDbGllbnQgPSBtb2NrQ2xpZW50KENsb3VkV2F0Y2hMb2dzQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrQ29kZUJ1aWxkQ2xpZW50ID0gbW9ja0NsaWVudChDb2RlQnVpbGRDbGllbnQpO1xuZXhwb3J0IGNvbnN0IG1vY2tFQzJDbGllbnQgPSBtb2NrQ2xpZW50KEVDMkNsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja0VDUkNsaWVudCA9IG1vY2tDbGllbnQoRUNSQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrRUNTQ2xpZW50ID0gbW9ja0NsaWVudChFQ1NDbGllbnQpO1xuZXhwb3J0IGNvbnN0IG1vY2tFbGFzdGljTG9hZEJhbGFuY2luZ1YyQ2xpZW50ID0gbW9ja0NsaWVudChFbGFzdGljTG9hZEJhbGFuY2luZ1YyQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrSUFNQ2xpZW50ID0gbW9ja0NsaWVudChJQU1DbGllbnQpO1xuZXhwb3J0IGNvbnN0IG1vY2tLTVNDbGllbnQgPSBtb2NrQ2xpZW50KEtNU0NsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja0xhbWJkYUNsaWVudCA9IG1vY2tDbGllbnQoTGFtYmRhQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrUm91dGU1M0NsaWVudCA9IG1vY2tDbGllbnQoUm91dGU1M0NsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja1MzQ2xpZW50ID0gbW9ja0NsaWVudChTM0NsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja1NlY3JldHNNYW5hZ2VyQ2xpZW50ID0gbW9ja0NsaWVudChTZWNyZXRzTWFuYWdlckNsaWVudCk7XG5leHBvcnQgY29uc3QgbW9ja1NTTUNsaWVudCA9IG1vY2tDbGllbnQoU1NNQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrU3RlcEZ1bmN0aW9uc0NsaWVudCA9IG1vY2tDbGllbnQoU0ZOQ2xpZW50KTtcbmV4cG9ydCBjb25zdCBtb2NrU1RTQ2xpZW50ID0gbW9ja0NsaWVudChTVFNDbGllbnQpO1xuXG4vKipcbiAqIFJlc2V0cyBjbGllbnRzIGJhY2sgdG8gZGVmYXVsdHMgYW5kIHJlc2V0cyB0aGUgaGlzdG9yeVxuICogb2YgdXNhZ2Ugb2YgdGhlIG1vY2suXG4gKi9cbmV4cG9ydCBjb25zdCByZXN0b3JlU2RrTW9ja3NUb0RlZmF1bHQgPSAoKSA9PiB7XG4gIG1vY2tBcHBTeW5jQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tBcHBTeW5jQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0Nsb3VkRm9ybWF0aW9uQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tDbG91ZEZvcm1hdGlvbkNsaWVudC5vbkFueUNvbW1hbmQoKS5yZXNvbHZlcyh7fSk7XG4gIG1vY2tDbG91ZFdhdGNoQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tDbG91ZFdhdGNoQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0NvZGVCdWlsZENsaWVudC5yZXNldCgpO1xuICBtb2NrQ29kZUJ1aWxkQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0VDMkNsaWVudC5yZXNldCgpO1xuICBtb2NrRUMyQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0VDUkNsaWVudC5yZXNldCgpO1xuICBtb2NrRUNSQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0VDU0NsaWVudC5yZXNldCgpO1xuICBtb2NrRUNTQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja0VsYXN0aWNMb2FkQmFsYW5jaW5nVjJDbGllbnQucmVzZXQoKTtcbiAgbW9ja0VsYXN0aWNMb2FkQmFsYW5jaW5nVjJDbGllbnQub25BbnlDb21tYW5kKCkucmVzb2x2ZXMoe30pO1xuICBtb2NrSUFNQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tJQU1DbGllbnQub25BbnlDb21tYW5kKCkucmVzb2x2ZXMoe30pO1xuICBtb2NrS01TQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tLTVNDbGllbnQub25BbnlDb21tYW5kKCkucmVzb2x2ZXMoe30pO1xuICBtb2NrTGFtYmRhQ2xpZW50LnJlc2V0KCk7XG4gIG1vY2tMYW1iZGFDbGllbnQub25BbnlDb21tYW5kKCkucmVzb2x2ZXMoe30pO1xuICBtb2NrUm91dGU1M0NsaWVudC5yZXNldCgpO1xuICBtb2NrUm91dGU1M0NsaWVudC5vbkFueUNvbW1hbmQoKS5yZXNvbHZlcyh7fSk7XG4gIG1vY2tTM0NsaWVudC5yZXNldCgpO1xuICBtb2NrUzNDbGllbnQub25BbnlDb21tYW5kKCkucmVzb2x2ZXMoe30pO1xuICBtb2NrU2VjcmV0c01hbmFnZXJDbGllbnQucmVzZXQoKTtcbiAgbW9ja1NlY3JldHNNYW5hZ2VyQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja1NTTUNsaWVudC5yZXNldCgpO1xuICBtb2NrU1NNQ2xpZW50Lm9uQW55Q29tbWFuZCgpLnJlc29sdmVzKHt9KTtcbiAgbW9ja1N0ZXBGdW5jdGlvbnNDbGllbnQucmVzZXQoKTtcbiAgbW9ja1NTTUNsaWVudC5vbkFueUNvbW1hbmQoKS5yZXNvbHZlcyh7fSk7XG4gIG1vY2tTVFNDbGllbnQucmVzZXQoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZXREZWZhdWx0U1RTTW9ja3MgPSAoKSA9PiB7XG4gIG1vY2tTVFNDbGllbnQub24oR2V0Q2FsbGVySWRlbnRpdHlDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgQWNjb3VudDogJzEyMzQ1Njc4OTAxMicsXG4gICAgQXJuOiAnYXdzOnN3YToxMjM0NTY3ODkwMTI6c29tZS1vdGhlci1zdHVmZicsXG4gIH0pO1xuICBtb2NrU1RTQ2xpZW50Lm9uKEFzc3VtZVJvbGVDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgQ3JlZGVudGlhbHM6IHtcbiAgICAgIEFjY2Vzc0tleUlkOiBGQUtFX0NSRURFTlRJQUxTLmFjY2Vzc0tleUlkLFxuICAgICAgU2VjcmV0QWNjZXNzS2V5OiBGQUtFX0NSRURFTlRJQUxTLnNlY3JldEFjY2Vzc0tleSxcbiAgICAgIFNlc3Npb25Ub2tlbjogRkFLRV9DUkVERU5USUFMUy5zZXNzaW9uVG9rZW4sXG4gICAgICBFeHBpcmF0aW9uOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzYwMCAqIDEwMDApLFxuICAgIH0sXG4gIH0pO1xufTtcblxuLyoqXG4gKiBNb2NrU2RrUHJvdmlkZXIgdGhhdCBpcyBtb3N0bHkgU2RrUHJvdmlkZXIgYnV0XG4gKiB3aXRoIGZha2UgY3JlZGVudGlhbHMgYW5kIGFjY291bnQgaW5mb3JtYXRpb24uXG4gKlxuICogRm9yIG1vY2tpbmcgdGhlIGFjdHVhbCBjbGllbnRzLCB0aGUgYWJvdmUgbW9ja2luZ1xuICogY2xpZW50cyBtYXkgYmUgdXNlZC5cbiAqL1xuZXhwb3J0IGNsYXNzIE1vY2tTZGtQcm92aWRlciBleHRlbmRzIFNka1Byb3ZpZGVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoRkFLRV9DUkVERU5USUFMX0NIQUlOLCAnYmVybXVkYS10cmlhbmdsZS0xMzM3Jyk7XG4gIH1cblxuICBwdWJsaWMgZGVmYXVsdEFjY291bnQoKTogUHJvbWlzZTxBY2NvdW50IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IGFjY291bnRJZDogJzEyMzQ1Njc4OTAxMicsIHBhcnRpdGlvbjogJ2F3cycgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBNb2NrU2RrIHRoYXQgaXMgbW9zdGx5IGp1c3QgdGhlIFNESyBidXQgd2l0aCBmYWtlXG4gKiBjcmVkZW50aWFscyBhbmQgYSBmdWxsIHNldCBvZiBkZWZhdWx0IGNsaWVudCBtb2Nrcy5cbiAqIFRoZXNlIGluZGl2aWR1YWwgZnVuY3Rpb25zIHdpdGhpbiB0aG9zZSBjbGllbnRzIGNhbiBiZVxuICogY3VzdG9taXplZCBpbiB0aGUgdGVzdCBmaWxlIHRoYXQgdXNlcyBpdC5cbiAqL1xuZXhwb3J0IGNsYXNzIE1vY2tTZGsgZXh0ZW5kcyBTREsge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICByZXN0b3JlU2RrTW9ja3NUb0RlZmF1bHQoKTtcbiAgICBzdXBlcihGQUtFX0NSRURFTlRJQUxTLCAnYmVybXVkYS10cmlhbmdsZS0xMzM3Jywge30pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtb2NrQm9vdHN0cmFwU3RhY2soc3RhY2s/OiBQYXJ0aWFsPFN0YWNrPikge1xuICByZXR1cm4gQ2xvdWRGb3JtYXRpb25TdGFjay5mcm9tU3RhdGljSW5mb3JtYXRpb24obmV3IE1vY2tTZGsoKS5jbG91ZEZvcm1hdGlvbigpLCAnQ0RLVG9vbGtpdCcsIHtcbiAgICBDcmVhdGlvblRpbWU6IG5ldyBEYXRlKCksXG4gICAgU3RhY2tOYW1lOiAnQ0RLVG9vbGtpdCcsXG4gICAgU3RhY2tTdGF0dXM6IFN0YWNrU3RhdHVzLkNSRUFURV9DT01QTEVURSxcbiAgICAuLi5zdGFjayxcbiAgICBPdXRwdXRzOiBbXG4gICAgICB7IE91dHB1dEtleTogJ0J1Y2tldE5hbWUnLCBPdXRwdXRWYWx1ZTogJ0JVQ0tFVF9OQU1FJyB9LFxuICAgICAgeyBPdXRwdXRLZXk6ICdCdWNrZXREb21haW5OYW1lJywgT3V0cHV0VmFsdWU6ICdCVUNLRVRfRU5EUE9JTlQnIH0sXG4gICAgICB7IE91dHB1dEtleTogJ0ltYWdlUmVwb3NpdG9yeU5hbWUnLCBPdXRwdXRWYWx1ZTogJ1JFUE9fTkFNRScgfSxcbiAgICAgIHsgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsIE91dHB1dFZhbHVlOiAnMScgfSxcbiAgICAgIC4uLihzdGFjaz8uT3V0cHV0cyA/PyBbXSksXG4gICAgXSxcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtb2NrUmVzb2x2ZWRFbnZpcm9ubWVudCgpOiBFbnZpcm9ubWVudCB7XG4gIHJldHVybiB7XG4gICAgYWNjb3VudDogJzEyMzQ1Njc4OScsXG4gICAgcmVnaW9uOiAnYmVybXVkYS10cmlhbmdsZS0xMzM3JyxcbiAgICBuYW1lOiAnYXdzOi8vMTIzNDU2Nzg5L2Jlcm11ZGEtdHJpYW5nbGUtMTMzNycsXG4gIH07XG59XG4iXX0=